---
import Layout from '../../layouts/Layout.astro'
import Banner from '../../components/Banner.astro'
import { blogs } from '../../../data/blog'
import CallAction from '../../components/CallAction.astro'

export async function getStaticPaths() {
  return blogs.map(blog => ({
    params: { slug: blog.slug }
  }))
}

const { slug } = Astro.params
const blog = blogs.find(b => b.slug === slug)

if (!blog) {
  throw new Error('Blog bulunamadı')
}

// Diğer blogları getir (mevcut blog hariç)
const otherBlogs = blogs.filter(b => b.slug !== slug).slice(0, 3)

const breadcrumbs = [
  { label: "Anasayfa", href: "/" },
  { label: "Bloglar", href: "/blog" },
  { label: blog.title, href: `/blog/${blog.slug}` },
]

// Tarihi formatla
const formatDate = (dateString: string) => {
  const options: Intl.DateTimeFormatOptions = { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  }
  return new Date(dateString).toLocaleDateString('tr-TR', options)
}
---

<Layout>
  <div class="mt-20">
    <Banner
      title={blog.title}
      image="/images/page-banner.webp"
      breadcrumbs={breadcrumbs}
    />
  </div>

  <div class="container mx-auto px-4 py-12">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Ana İçerik -->
      <div class="lg:w-2/3">
        <!-- Blog Başlığı ve Meta Bilgiler -->
        <article class="bg-white rounded-lg shadow-sm overflow-hidden">
          <!-- Blog Görseli -->
          <div class="aspect-video overflow-hidden">
            <img 
              src={blog.image || '/images/default-blog.jpg'} 
              alt={blog.title}
              class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
            />
          </div>
          
          <!-- İçerik -->
          <div class="p-6 lg:p-8">
            <!-- Meta Bilgiler -->
            <div class="flex items-center gap-4 text-sm text-gray-600 mb-6">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span>{formatDate(blog.date)}</span>
              </div>
            </div>
            
            <!-- Blog Başlığı -->
            <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-6 leading-tight">
              {blog.title}
            </h1>
            
            <!-- Blog Açıklaması -->
            <div class="text-lg text-gray-700 mb-8 leading-relaxed">
              <p>{blog.desc}</p>
            </div>
            
            <!-- Blog İçeriği -->
            <div class="prose prose-lg max-w-none">
              {blog.content ? (
                <div set:html={blog.content} />
              ) : (
                <div class="text-gray-700 leading-relaxed space-y-4">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                  
                  <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                  
                  <h3 class="text-xl font-semibold text-gray-900 mt-8 mb-4">Alt Başlık Örneği</h3>
                  
                  <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
                  
                  <ul class="list-disc list-inside space-y-2">
                    <li>Birinci madde örneği</li>
                    <li>İkinci madde örneği</li>
                    <li>Üçüncü madde örneği</li>
                  </ul>
                </div>
              )}
            </div>
          </div>
        </article>
        
        <!-- Etiketler -->
        {blog.labels && blog.labels.length > 0 && (
          <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Etiketler</h3>
            <div class="flex flex-wrap gap-2">
              {blog.labels.map((tag) => (
                <span
                  class="inline-block bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-blue-100 transition-colors cursor-pointer"
                >
                  #{tag}
                </span>
              ))}
            </div>
          </div>
        )}

      </div>
      
      <!-- Sidebar -->
      <div class="lg:w-1/3">
        <div class="sticky top-8 space-y-6">
          <!-- Diğer Bloglar -->
          {otherBlogs.length > 0 && (
            <div class="bg-white rounded-lg shadow-sm p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 border-b border-gray-200 pb-2">
                Diğer Yazılar
              </h3>
              <div class="space-y-4">
                {otherBlogs.map((otherBlog) => (
                  <a 
                    href={`/blog/${otherBlog.slug}`} 
                    class="block group hover:bg-gray-50 rounded-lg p-3 transition-colors"
                  >
                    <div class="flex gap-3">
                      <div class="flex-shrink-0">
                        <img 
                          src={otherBlog.image || '/images/default-blog.jpg'} 
                          alt={otherBlog.title}
                          class="w-16 h-16 object-cover rounded-lg"
                        />
                      </div>
                      <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-medium text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2 mb-1">
                          {otherBlog.title}
                        </h4>
                        <p class="text-xs text-gray-500">
                          {formatDate(otherBlog.date)}
                        </p>
                      </div>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          )}

        </div>
      </div>
    </div>
  </div>

  <CallAction />
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
    color: #1f2937;
    font-weight: 600;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }
  
  .prose p {
    margin-bottom: 1em;
  }
  
  .prose ul, .prose ol {
    margin-bottom: 1em;
  }
  
  .prose blockquote {
    border-left: 4px solid #3b82f6;
    padding-left: 1rem;
    margin: 1.5em 0;
    font-style: italic;
    color: #4b5563;
  }
</style>