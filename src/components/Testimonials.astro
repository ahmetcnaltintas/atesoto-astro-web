---
import { testimonials } from "../../data/testimonials";
---

<style>
  .testimonials-section {
    position: relative;
    padding: 4rem 0;
    background-color: #f9fafb;
  }

  .testimonials-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    position: relative;
  }

  .testimonials-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .testimonials-title {
    font-size: 2.5rem;
    font-weight: bold;
    color: #111827;
    margin-bottom: 1rem;
  }

  .testimonials-subtitle {
    font-size: 1.125rem;
    color: #6b7280;
    max-width: 32rem;
    margin: 0 auto;
  }

  .carousel-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 0.75rem;
  }

  .carousel-track {
    display: flex;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
  }

  .testimonial-slide {
    flex: 0 0 100%;
    padding: 0 0.5rem;
    box-sizing: border-box;
  }

  .testimonial-card {
    background: white;
    padding: 2rem;
    border-radius: 0.75rem;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    height: auto;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border: 1px solid #e5e7eb;
  }

  .stars-container {
    display: flex;
    margin-bottom: 1rem;
    gap: 0.25rem;
  }

  .star-icon {
    width: 1.25rem;
    height: 1.25rem;
    color: #fbbf24;
    fill: currentColor;
  }

  .testimonial-message {
    color: #4b5563;
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    font-style: italic;
    flex-grow: 1;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
  }

  .author-avatar {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.125rem;
    margin-right: 0.75rem;
  }

  .author-info {
    flex: 1;
  }

  .author-name {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.125rem;
  }

  .author-location {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Navigation Buttons */
  .nav-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #374151;
    z-index: 10;
    transition: all 0.2s ease;
  }

  .nav-button:hover {
    background: #f9fafb;
    box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
    transform: translateY(-50%) scale(1.05);
  }

  .nav-button:active {
    transform: translateY(-50%) scale(0.95);
  }

  .nav-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .nav-button:disabled:hover {
    transform: translateY(-50%);
    background: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .prev-button {
    left: -4rem;
  }

  .next-button {
    right: -4rem;
  }

  /* Dots Indicator */
  .dots-container {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 2rem;
  }

  .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: #d1d5db;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .dot.active {
    background: #3b82f6;
    transform: scale(1.2);
  }

  .dot:hover {
    background: #9ca3af;
  }

  /* Responsive Design */
  @media (min-width: 640px) {
    .testimonial-slide {
      flex: 0 0 50%;
    }
    .testimonials-title {
      font-size: 3rem;
    }
  }

  @media (min-width: 1024px) {
    .testimonial-slide {
      flex: 0 0 33.333%;
    }
    .testimonials-container {
      padding: 0 2rem;
    }
  }

  @media (max-width: 1023px) {
    .prev-button {
      left: -1rem;
      width: 2.5rem;
      height: 2.5rem;
      font-size: 1.25rem;
    }
    .next-button {
      right: -1rem;
      width: 2.5rem;
      height: 2.5rem;
      font-size: 1.25rem;
    }
  }

  @media (max-width: 639px) {
    .prev-button {
      left: 0.5rem;
    }
    .next-button {
      right: 0.5rem;
    }
    .testimonials-container {
      padding: 0 0.5rem;
    }
    .testimonial-card {
      padding: 1.5rem;
    }
    .testimonials-title {
      font-size: 2rem;
    }
  }

  /* Avatar Colors */
  .avatar-red { background-color: #dc2626; }
  .avatar-blue { background-color: #2563eb; }
  .avatar-green { background-color: #16a34a; }
  .avatar-purple { background-color: #9333ea; }
  .avatar-orange { background-color: #ea580c; }
  .avatar-pink { background-color: #db2777; }
</style>

<section class="testimonials-section" id="yorumlar">
  <div class="testimonials-container">
    <div class="testimonials-header">
      <h2 class="testimonials-title">Müşteri Yorumları</h2>
      <p class="testimonials-subtitle">Memnun müşterilerimizin deneyimleri</p>
    </div>

    <div class="carousel-wrapper">
      <button class="nav-button prev-button" id="prevBtn" aria-label="Önceki yorumlar">
        ‹
      </button>

      <div class="carousel-track" id="carouselTrack">
        {testimonials.map((testimonial, index) => (
          <div class="testimonial-slide">
            <article class="testimonial-card">
              <div class="stars-container">
                {Array.from({ length: 5 }, (_, starIndex) => (
                  <svg
                    class="star-icon"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
              
              <p class="testimonial-message">"{testimonial.message}"</p>
              
              <div class="testimonial-author">
                <div class={`author-avatar avatar-${
                  ['red', 'blue', 'green', 'purple', 'orange', 'pink'][index % 6]
                }`}>
                  {testimonial.name.charAt(0)}
                </div>
                <div class="author-info">
                  <p class="author-name">{testimonial.name}</p>
                  <p class="author-location">{testimonial.location}</p>
                </div>
              </div>
            </article>
          </div>
        ))}
      </div>

      <button class="nav-button next-button" id="nextBtn" aria-label="Sonraki yorumlar">
        ›
      </button>
    </div>

    <div class="dots-container" id="dotsContainer">
      <!-- Dots will be generated by JavaScript -->
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const track = document.getElementById('carouselTrack') as HTMLElement;
    const prevBtn = document.getElementById('prevBtn') as HTMLButtonElement;
    const nextBtn = document.getElementById('nextBtn') as HTMLButtonElement;
    const dotsContainer = document.getElementById('dotsContainer') as HTMLElement;

    if (!track || !prevBtn || !nextBtn || !dotsContainer) {
      console.error('Carousel elements not found');
      return;
    }
    
    const slides = track.children;
    const totalSlides = slides.length;
    
    let currentIndex = 0;
    let slidesPerView = 1;
    let maxIndex = 0;

    function updateSlidesPerView(): void {
      const width = window.innerWidth;
      if (width >= 1024) {
        slidesPerView = 3;
      } else if (width >= 640) {
        slidesPerView = 2;
      } else {
        slidesPerView = 1;
      }
      maxIndex = Math.max(0, totalSlides - slidesPerView);

      if (currentIndex > maxIndex) {
        currentIndex = maxIndex;
      }
    }
    function createDots(): void {
      if (!dotsContainer) return;
      
      dotsContainer.innerHTML = '';
      
      for (let i = 0; i <= maxIndex; i++) {
        const dot = document.createElement('button');
        dot.className = 'dot';
        dot.setAttribute('aria-label', `Yorum grubu ${i + 1}`);
        dot.addEventListener('click', () => goToSlide(i));
        dotsContainer.appendChild(dot);
      }
    }
    function updateCarousel(): void {
      if (!track || !dotsContainer) return;
      
      const translateX = -(currentIndex * (100 / slidesPerView));
      track.style.transform = `translateX(${translateX}%)`;
      
      const dots = dotsContainer.children;
      for (let i = 0; i < dots.length; i++) {
        dots[i].classList.toggle('active', i === currentIndex);
      }
      
      if (prevBtn) prevBtn.disabled = currentIndex === 0;
      if (nextBtn) nextBtn.disabled = currentIndex === maxIndex;
    }

    function goToSlide(index: number): void {
      currentIndex = Math.max(0, Math.min(index, maxIndex));
      updateCarousel();
    }

    function nextSlide(): void {
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateCarousel();
      }
    }

    function prevSlide(): void {
      if (currentIndex > 0) {
        currentIndex--;
        updateCarousel();
      }
    }

    function init(): void {
      updateSlidesPerView();
      createDots();
      updateCarousel();
    }

    if (nextBtn) nextBtn.addEventListener('click', nextSlide);
    if (prevBtn) prevBtn.addEventListener('click', prevSlide);
    
    let resizeTimeout: number;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = window.setTimeout(() => {
        init();
      }, 100);
    });
    
    document.addEventListener('keydown', (e: KeyboardEvent) => {
      const target = e.target as HTMLElement;
      if (target && target.closest('.testimonials-section')) {
        if (e.key === 'ArrowLeft') {
          prevSlide();
        } else if (e.key === 'ArrowRight') {
          nextSlide();
        }
      }
    });

    init();
  });
</script>